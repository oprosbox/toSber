function ChatHelpJS(a){this.load=!1,this.start=!0,this.helpers,this.lang="ru",this.ns="chat-help",this.user,this.operator=!1,this.files={},this.tmpVariable={},this.webConfig={},this.chat={options:!1},this.socket;var b=this;this.loadSocketJS=function(){this.addJS(this.config.staticURL+"/js.min/ch-socket.js",!0,function(){b.addJS(b.config.staticURL+"/js.min/helpers.js",!0,function(){b.helpers=new CHHelpers,b.init(),window.onfocus=function(){b.socket&&b.socket.disconnected&&b.init()}})});var a=document.getElementsByTagName("head")[0]||document.documentElement,c=document.createElement("link");c.setAttribute("type","text/css"),c.setAttribute("rel","stylesheet"),c.setAttribute("async","true"),c.setAttribute("href",this.config.staticURL+"/css/chstyle.css"),a.appendChild(c)},this.addJS=function(a,b,c){var d=document.getElementsByTagName("head")[0]||document.documentElement,e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src",a),e.setAttribute("charset","utf-8"),b&&e.setAttribute("async","true"),"function"==typeof c&&(e.onload=c),d.appendChild(e)},this.init=function(){(void 0==this.socket||1==this.socket.disconnected)&&(this.socket&&this.socket.disconnected&&(b.tmpVariable.loadChat=!0),this.socket=io.connect(this.config.socketURL,{forceNew:!0,reconnection:!0,reconnectionDelay:2e4,reconnectionDelayMax:5e4,reconnectionAttempts:5}),this.socket.on("connect",function(){b.getWebConfig(),localStorage.getItem(b.ns+"-user-id")?b.socket.emit("checkUser",{user_id:localStorage.getItem(b.ns+"-user-id"),site_id:b.config.siteId}):b.socket.emit("get_user_id"),document.getElementById(b.ns+"-chat-container")&&b.tmpVariable.loadChat&&(b.tmpVariable.loadChat=!1,b.load=!1,b.tmpVariable.openButtonNone=!0,document.getElementById(b.ns+"-button-layer")&&document.getElementById(b.ns+"-button-layer").remove(),clearInterval(b.tmpVariable.updateInterval),b.loadChat())}),this.socket.on("chek_user",function(a){a.result?(b.user=localStorage.getItem(b.ns+"-user-id"),b.socket.emit("user_init",{user_id:b.user}),b.loadChat()):b.socket.emit("get_user_id")}),this.socket.on("set_user_id",function(a){localStorage.setItem(b.ns+"-user-id",a.user_id),b.user=a.user_id,b.socket.emit("user_init",a),b.loadChat()}),this.socket.on("force_destroy",function(){b.socket.disconnect(),"function"==typeof b.stopWatch&&b.stopWatch()}))},this.loadChat=function(){if(!this.load){b.load=!0,this.tmpVariable.updateInterval=setInterval(function(){var a={user:b.user,width:b.helpers.width(),height:b.helpers.height()};0==b.socket.disconnected&&b.socket.emit("updateUser",a)},3e4),this.socket.on("loadChat",function(a){b.chat.options=a,b.chat.options.language&&(b.lang=b.chat.options.language),b.languages&&"function"==typeof b.renderButton?b.processLoadChat():b.addJS(b.config.staticURL+"/js.min/languages/"+b.lang+".js",!0,function(){b.addJS(b.config.staticURL+"/js.min/ch-button.js",!0,function(){b.processLoadChat()})})});var a={siteId:this.config.siteId,user:this.user,width:this.helpers.width(),height:this.helpers.height(),referrer:"undefined"==typeof document.referrer?"":document.referrer,title:document.title};this.socket.emit("loadChat",a)}},this.processLoadChat=function(){this.socket.on("setOperator",function(a){if(a||!b.chat.options.dontShowOfflineForm){if(b.renderButton(),b.operator&&a&&b.operator.id!=a.id){var c=b.languages.new_operator+"<b>"+a.name+" "+a.famil+"</b>";b.processMessage(c,!1,a.name+" "+a.famil)}b.operator=a,b.operator?(document.getElementById(b.ns+"-chat-container")&&document.getElementById(b.ns+"-chat-container").remove(),"undefined"==typeof b.createOnlineChat?b.addJS(b.config.staticURL+"/js.min/ch-onlinechat.js",!0,function(){b.createOnlineChat()}):b.createOnlineChat()):(b.updateWebConfig("watch",0),b.addJS(b.config.staticURL+"/js.min/ch-offlinechat.js",!0,function(){document.getElementById(b.ns+"-chat-container")?b.helpers.fadeOut(document.getElementById(b.ns+"-chat-container"),50,function(){document.getElementById(b.ns+"-chat-container").remove(),b.createOfflineChat()}):b.createOfflineChat()}))}}),this.socket.emit("getOperator",{user:this.user,siteID:this.config.siteId}),this.socket.on("change_operator",function(a){b.socket.emit("getOperator",{user:b.user,siteID:b.config.siteId})})},this.setPosition=function(a){if(b.helpers.getCookie(b.ns+"-pos-x")&&b.helpers.getCookie(b.ns+"-pos-y")){var c=b.helpers.getCookie(b.ns+"-pos-x"),d=b.helpers.getCookie(b.ns+"-pos-y");0>c&&(c=1),c>window.innerWidth-325&&(c=window.innerWidth-325),d>window.innerHeight-455&&(d=window.innerHeight-455),0>d&&(d=1),a.style.left=c+"px",a.style.top=d+"px"}0==b.webConfig["close-chat"]&&(document.getElementById(b.ns+"-chat-container").style.display="block",document.getElementById(b.ns+"-button-chat")&&(document.getElementById(b.ns+"-button-chat").style.display="none"))},this.openChat=function(a,c,d){return b.tmpVariable.openButtonNone?void(b.tmpVariable.openButtonNone=!1):1==a?void b.helpers.fadeIn(document.getElementById(b.ns+"-chat-container"),50,function(){b.updateWebConfig("close-chat",!1),c&&b.helpers.fadeOut(document.getElementById(b.ns+"-button-chat"),50,function(){})}):void("undefined"==typeof this.getAttribute&&1!=d||this.getAttribute&&this.getAttribute("id")==b.ns+"-close"?b.helpers.fadeOut(document.getElementById(b.ns+"-chat-container"),5,function(){b.updateWebConfig("close-chat",!0),document.getElementById(b.ns+"-button-chat")&&b.helpers.fadeIn(document.getElementById(b.ns+"-button-chat"),5,function(){})}):b.helpers.fadeIn(document.getElementById(b.ns+"-chat-container"),5,function(){b.updateWebConfig("close-chat",!1),document.getElementById(b.ns+"-button-chat")&&b.helpers.fadeOut(document.getElementById(b.ns+"-button-chat"),5,function(){})}))},this.getWebConfig=function(){try{var a=localStorage.getItem(b.ns+"-config");if(a&&""!=a)return void(this.webConfig=JSON.parse(a));this.webConfig={}}catch(c){console.error(c),this.webConfig={}}},this.updateWebConfig=function(a,c){try{this.webConfig[a]=c,localStorage.setItem(b.ns+"-config",JSON.stringify(this.webConfig))}catch(d){console.error(d)}},this.mousePageXY=function(a){b.tmpVariable.coord_arr.length>250&&(b.tmpVariable.coord_arr=[]);var c=0,d=0;a||(a=window.event),a.pageX||a.pageY?(c=a.pageX,d=a.pageY):(a.clientX||a.clientY)&&(c=a.clientX+(document.documentElement.scrollLeft||document.body.scrollLeft)-document.documentElement.clientLeft,d=a.clientY+(document.documentElement.scrollTop||document.body.scrollTop)-document.documentElement.clientTop),b.tmpVariable.coord_arr[b.tmpVariable.coord_arr.length]={x:c,y:d}};var c=document.getElementsByTagName("script");for(var d in c)if(c.hasOwnProperty(d)&&c[d].src&&-1!=c[d].src.indexOf(".chathelp.ru")){var e=c[d].src.split("/");this.addJS("//"+e[2]+"/js/ch-config.js",!0,function(){b.config.siteId=a,b.loadSocketJS()});break}}ChatHelpJS.prototype.addCustomStyle=function(a,b){var c,d,e,f,g;return f="chat-help-custom-style",e=document.getElementById(f),e||(e=document.createElement("style"),e.id=f,document.head.appendChild(e)),g=[".chat-help .chat-help-win"],c=[".chat-help .chat-help-win-write-submit",".chat-help .chat-help-button",".chat-help .chat-help-win-chat.right .chat-help-win-chat-text"],d=[],a&&d.push(""+g.join(",")+"{background-color:"+a+"}"),b&&d.push(""+c.join(",")+"{background-color:"+b+"}"),e.innerHTML=d.join("")};